<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JAGUAR COMMAND CENTER</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;900&display=swap" rel="stylesheet">
    <style>
        body { background-color: #050505; color: #e5e5e5; font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .neon-green { color: #39FF14; text-shadow: 0 0 15px rgba(57, 255, 20, 0.6); }
        .neon-red { color: #FF073A; text-shadow: 0 0 15px rgba(255, 7, 58, 0.6); }
        /* Taller cards to match concept */
        .glass-panel { 
            background: linear-gradient(145deg, rgba(20,20,20,0.8) 0%, rgba(10,10,10,0.95) 100%); 
            border: 1px solid rgba(255, 255, 255, 0.08); 
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
            min-height: 160px; /* Ensure height */
        }
        .btn-execute {
            background: rgba(57, 255, 20, 0.05); border: 2px solid #39FF14; color: #39FF14;
            transition: all 0.2s; box-shadow: 0 0 15px rgba(57,255,20,0.1);
        }
        .btn-execute:active { transform: scale(0.95); }
        .btn-execute.short { background: rgba(255, 7, 58, 0.05); border-color: #FF073A; color: #FF073A; box-shadow: 0 0 15px rgba(255, 7, 58, 0.1); }
        .btn-execute.wait { background: rgba(100,100,100,0.1); border-color: #666; color: #888; box-shadow: none; cursor: not-allowed; }

        
        .tf-container { -ms-overflow-style: none; scrollbar-width: none; }
        .tf-container::-webkit-scrollbar { display: none; }
        .tf-btn {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #888;
            font-family: 'JetBrains Mono'; font-size: 0.7rem; transition: all 0.2s; white-space: nowrap; min-width: 35px;
        }
        .tf-btn:hover { border-color: #39FF14; color: #fff; }
        .tf-btn.active { background: #39FF14; color: #000; border-color: #39FF14; font-weight: bold; }

        #guide-modal { transition: opacity 0.3s ease; }
        .guide-card { border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.03); padding: 1rem; rounded: 0.5rem; min-height: auto; }

        @media (max-width: 1024px) {
            .desktop-grid { display: flex; flex-direction: column; gap: 1rem; }
            .mobile-chart { height: 450px; order: -1; min-height: 450px; } 
            .glass-panel { min-height: auto; } /* Reset min-height for mobile stacks */
        }
    </style>
</head>
<body class="min-h-screen w-full flex flex-col p-4 lg:p-6 overflow-y-auto lg:overflow-hidden relative">

    <header class="flex flex-col lg:flex-row justify-between items-center mb-6 shrink-0 gap-4 lg:gap-0">
        <div class="flex items-center gap-3 self-start lg:self-auto">
            <svg class="w-12 h-12 text-[#D4AF37]" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                 <path d="M3.5 13.5c0-1.8.8-3.3 2.1-4.2.6-.4 1.1-.1 1 .5-.2.8-.2 1.7 0 2.5.2.8 1 1.2 1.8 1.1.9-.2 1.5-.9 1.4-1.8-.1-.7-.5-1.3-1.1-1.6-.5-.3-1.1-.3-1.6 0-.4.2-.8.1-1-.2-.6-1.1-.2-2.4 1-2.9 1.2-.5 2.6-.3 3.7.6.9.7 1.4 1.8 1.5 2.9.1 1.6-1.1 3-2.7 3.2-1.6.2-3.1-1-3.3-2.6-.2-1.3.6-2.5 1.8-3 1.1-.5 2.4-.1 3 .9.1.2.3.2.5.1.2-.1.3-.3.2-.5-.8-1.4-2.6-1.9-4.1-1.2-1.5.7-2.3 2.4-1.9 4 .4 1.5 1.8 2.6 3.4 2.5 1.6-.1 2.9-1.4 3-3 .1-1.3-.6-2.5-1.7-3.1l.1-.1c1.5-.6 3.2-.4 4.5.6 1.8 1.3 2.6 3.6 2 5.7-.5 2.1-2.4 3.6-4.6 3.6h-.5c-.4 0-.7.3-.7.7 0 .4.3.7.7.7h.5c2.6 0 4.9-1.8 5.5-4.3.7-2.6-.3-5.3-2.4-6.8-1.8-1.3-4.1-1.5-6.1-.5-2.5 1.2-3.9 4-3.4 6.7.4 2.3 2.3 4.1 4.7 4.2h.5c.4 0 .7-.3.7-.7 0-.4-.3-.7-.7-.7h-.5c-2-.1-3.7-1.7-3.7-3.8z"/>
            </svg>
            <div>
                <h1 class="text-2xl font-black tracking-[0.1em] text-white">JAGUAR <span class="text-[#D4AF37]">3·6·9</span></h1>
                <div class="text-xs text-gray-500 tracking-widest">COMMAND CENTER</div>
            </div>
            <button onclick="toggleModal(true)" class="ml-4 w-8 h-8 rounded-full border border-gray-700 flex items-center justify-center text-gray-500 hover:text-white hover:border-white transition-colors">?</button>
        </div>
        
        <div class="flex gap-2 overflow-x-auto tf-container w-full lg:w-auto pb-1 lg:pb-0">
            <button class="tf-btn px-3 py-1 rounded active" onclick="changeTf('1m')" id="btn-1m">1m</button>
            <button class="tf-btn px-3 py-1 rounded" onclick="changeTf('5m')" id="btn-5m">5m</button>
            <button class="tf-btn px-3 py-1 rounded" onclick="changeTf('15m')" id="btn-15m">15m</button>
            <button class="tf-btn px-3 py-1 rounded" onclick="changeTf('30m')" id="btn-30m">30m</button>
            <button class="tf-btn px-3 py-1 rounded" onclick="changeTf('1h')" id="btn-1h">1H</button>
            <button class="tf-btn px-3 py-1 rounded" onclick="changeTf('4h')" id="btn-4h">4H</button>
            <button class="tf-btn px-3 py-1 rounded" onclick="changeTf('1d')" id="btn-1d">D</button>
            <button class="tf-btn px-3 py-1 rounded" onclick="changeTf('1w')" id="btn-1w">W</button>
        </div>
    </header>

    <div class="desktop-grid lg:grid lg:grid-cols-12 lg:grid-rows-6 gap-6 flex-1 lg:min-h-[600px]">
        
        <div class="lg:col-span-3 lg:row-span-6 flex flex-col gap-6">
            <div class="grid grid-cols-2 gap-4 flex-1">
                <div class="glass-panel rounded-2xl p-4 flex flex-col justify-center items-center">
                    <div class="text-[10px] text-gray-500 mb-1">LOCAL</div>
                    <div class="font-mono text-xl" id="clock-local">--:--</div>
                </div>
                <div class="glass-panel rounded-2xl p-4 flex flex-col justify-center items-center">
                    <div class="text-[10px] text-gray-500 mb-1">NY</div>
                    <div class="font-mono text-xl text-[#39FF14]" id="clock-ny">--:--</div>
                </div>
            </div>
            <div class="glass-panel rounded-2xl p-6 flex flex-col justify-center items-center flex-[2]">
                <div class="text-[10px] text-gray-500 tracking-widest mb-4">MAJOR TREND</div>
                <div class="text-4xl font-black mb-2" id="trend-text">WAITING</div>
                <div class="text-6xl animate-pulse" id="trend-icon">--</div>
            </div>
            <div class="glass-panel rounded-2xl p-5 flex flex-col justify-center flex-1">
                <div class="flex justify-between mb-2 items-end">
                    <span class="text-[10px] text-gray-500 uppercase">MFI Fuel</span>
                    <span class="text-xl font-mono" id="mfi-text-color"><span id="mfi-value">0</span>%</span>
                </div>
                <div class="w-full bg-gray-900 rounded-sm h-4 overflow-hidden border border-gray-800 relative">
                    <div class="bg-[#D4AF37] h-full transition-all duration-1000" style="width: 0%" id="mfi-bar"></div>
                </div>
                <div class="text-[9px] text-gray-600 mt-2 text-right">OVERBOUGHT > 80%</div>
            </div>
        </div>

        <div class="lg:col-span-6 lg:row-span-6 glass-panel rounded-2xl p-1 relative flex flex-col mobile-chart">
            <div class="absolute top-4 left-4 z-10 flex gap-3 flex-wrap">
                <div class="bg-black/60 backdrop-blur px-3 py-2 rounded border border-white/10 flex items-center gap-3">
                    <div class="w-8 h-8 bg-[#F7931A] rounded-full flex items-center justify-center text-black font-bold text-xs">₿</div>
                    <div>
                        <div class="font-bold text-white text-xs">Bitcoin</div>
                        <div class="font-mono text-lg text-white" id="price-display">$00,000.00</div>
                    </div>
                </div>
                <div class="bg-black/60 backdrop-blur px-3 py-2 rounded border border-white/10 flex items-center gap-2 font-mono text-xs">
                     <span class="text-gray-400">TF:</span>
                     <span class="text-[#39FF14]" id="chart-tf-display">1m</span>
                     <span class="text-gray-600">|</span>
                     <span class="text-gray-400">CLOSE IN:</span>
                     <span class="text-white font-bold" id="candle-countdown">--:--</span>
                </div>
            </div>
            <div id="tv-chart" class="w-full h-full rounded-xl overflow-hidden"></div>
        </div>

        <div class="lg:col-span-3 lg:row-span-6 flex flex-col gap-6">
            <div class="glass-panel rounded-2xl p-6 flex flex-col items-center justify-center flex-[2] relative overflow-hidden">
                <div class="text-[10px] text-gray-500 mb-4 tracking-widest">JAGUAR SCORE</div>
                <div class="text-8xl font-mono font-bold neon-green" id="score-display">0.0</div>
                <div class="text-gray-600 text-xs mt-2 text-center">CONFIDENCE<br>LEVEL / 10</div>
            </div>
            <button id="main-btn" class="glass-panel rounded-2xl p-8 btn-execute wait flex flex-col items-center justify-center flex-1 group" onclick="executeTrade()">
                <div class="text-2xl font-bold tracking-wider group-hover:scale-105 transition-transform" id="btn-text">WAITING...</div>
                <div class="text-xs mt-2 opacity-70 font-mono" id="btn-subtext">(ANALYZING MARKET)</div>
            </button>
        </div>
    </div>

    <div id="guide-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/90 opacity-0 pointer-events-none backdrop-blur-sm p-4">
        <div class="glass-panel max-w-2xl w-full max-h-[80vh] overflow-y-auto rounded-2xl p-8 relative">
            <button onclick="toggleModal(false)" class="absolute top-4 right-4 text-gray-500 hover:text-white">✕</button>
            <h2 class="text-2xl font-bold text-[#D4AF37] mb-6 tracking-widest">THE JAGUAR PROTOCOL <span class="text-xs text-gray-500">v4.0 Platinum</span></h2>
            <div class="space-y-6">
                <div><h3 class="text-white font-bold mb-2 flex items-center gap-2">1. CORE LOGIC <span class="text-xs bg-gray-800 px-2 py-1 rounded text-gray-400">3-6-9</span></h3><p class="text-sm text-gray-400 leading-relaxed">A weighted algorithm analyzing trend, momentum, and volume flow simultaneously to calculate probability.</p></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="guide-card"><div class="text-[#39FF14] font-mono text-xs mb-1">TREND</div><div class="font-bold text-white mb-1">EMA 200</div><p class="text-[10px] text-gray-400">The River. Trade only in the direction of the major trend.</p></div>
                    <div class="guide-card"><div class="text-[#39FF14] font-mono text-xs mb-1">MOMENTUM</div><div class="font-bold text-white mb-1">HMA 90</div><p class="text-[10px] text-gray-400">The Hunter. Fast-reacting moving average for entry timing.</p></div>
                    <div class="guide-card"><div class="text-[#D4AF37] font-mono text-xs mb-1">FUEL</div><div class="font-bold text-white mb-1">MFI 14</div><p class="text-[10px] text-gray-400">Gas Tank. <20% (Oversold/Buy), >80% (Overbought/Sell).</p></div>
                    <div class="guide-card"><div class="text-[#39FF14] font-mono text-xs mb-1">CONFIDENCE</div><div class="font-bold text-white mb-1">SCORE / 10</div><p class="text-[10px] text-gray-400">>7.5 (LONG), <2.5 (SHORT). Neutral in between.</p></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleModal(show) { const m = document.getElementById('guide-modal'); show ? m.classList.remove('pointer-events-none', 'opacity-0') : m.classList.add('pointer-events-none', 'opacity-0'); }

        const chartContainer = document.getElementById('tv-chart');
        const chart = LightweightCharts.createChart(chartContainer, {
            layout: { background: { color: '#000000' }, textColor: '#666', },
            grid: { vertLines: { color: '#111' }, horzLines: { color: '#111' } },
            rightPriceScale: { borderColor: '#333' },
            timeScale: { borderColor: '#333', timeVisible: true, secondsVisible: false },
        });
        const candleSeries = chart.addCandlestickSeries({ upColor: '#39FF14', downColor: '#FF073A', borderVisible: false, wickUpColor: '#39FF14', wickDownColor: '#FF073A' });
        const metaLine = candleSeries.createPriceLine({ price: 0, color: '#39FF14', lineWidth: 1, lineStyle: LightweightCharts.LineStyle.Dotted, axisLabelVisible: true, title: 'META 1' });

        new ResizeObserver(entries => { if (entries.length === 0 || entries[0].target !== chartContainer) return; chart.applyOptions({ width: entries[0].contentRect.width, height: entries[0].contentRect.height }); }).observe(chartContainer);

        let ws, nextCloseTime = 0, countdownInterval;

        function startCountdown() {
            clearInterval(countdownInterval);
            countdownInterval = setInterval(() => {
                if (!nextCloseTime) return;
                const now = Math.floor(Date.now() / 1000);
                const diff = nextCloseTime - now;
                if (diff <= 0) { document.getElementById('candle-countdown').innerText = "CLOSING..."; return; }
                const m = Math.floor(diff / 60); const s = diff % 60;
                document.getElementById('candle-countdown').innerText = `${m}:${s < 10 ? '0' + s : s}`;
            }, 1000);
        }

        function connect() {
            const protocol = window.location.protocol === "https:" ? "wss://" : "ws://";
            ws = new WebSocket(protocol + window.location.host + "/ws");
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                document.getElementById('price-display').innerText = "$" + data.price.toLocaleString(undefined, {minimumFractionDigits: 2});
                
                const scoreEl = document.getElementById('score-display'); scoreEl.innerText = data.score;
                scoreEl.className = data.score < 5 ? "text-8xl font-mono font-bold neon-red" : "text-8xl font-mono font-bold neon-green";

                const trendText = document.getElementById('trend-text'); const trendIcon = document.getElementById('trend-icon');
                trendText.innerText = data.trend;
                if(data.trend === "BULLISH") { trendText.className = "text-4xl font-black mb-2 neon-green"; trendIcon.innerText = "↑"; trendIcon.className = "text-6xl neon-green animate-bounce"; } 
                else if(data.trend === "BEARISH") { trendText.className = "text-4xl font-black mb-2 neon-red"; trendIcon.innerText = "↓"; trendIcon.className = "text-6xl neon-red animate-bounce"; }
                else { trendText.className = "text-4xl font-black mb-2 text-gray-500"; trendIcon.innerText = "--"; trendIcon.className = "text-6xl text-gray-500"; }

                document.getElementById('mfi-value').innerText = data.mfi; document.getElementById('mfi-bar').style.width = data.mfi + "%";
                document.getElementById('mfi-text-color').className = data.mfi > 80 ? "text-xl font-mono text-red-500" : (data.mfi < 20 ? "text-xl font-mono neon-green" : "text-xl font-mono text-[#D4AF37]");

                // DYNAMIC BUTTON LOGIC
                const btn = document.getElementById('main-btn'); const btnText = document.getElementById('btn-text'); const btnSub = document.getElementById('btn-subtext');
                if (data.score >= 7.5) { btn.className = "glass-panel rounded-2xl p-8 btn-execute flex flex-col items-center justify-center flex-1 group"; btnText.innerText = "EXECUTE LONG"; btnSub.innerText = "($100 RISK)"; }
                else if (data.score <= 2.5) { btn.className = "glass-panel rounded-2xl p-8 btn-execute short flex flex-col items-center justify-center flex-1 group"; btnText.innerText = "EXECUTE SHORT"; btnSub.innerText = "($100 RISK)"; }
                else { btn.className = "glass-panel rounded-2xl p-8 btn-execute wait flex flex-col items-center justify-center flex-1 group"; btnText.innerText = "WAITING FOR SIGNAL"; btnSub.innerText = "(SCORE MUST BE >7.5 or <2.5)"; }

                if (data.candle) {
                    candleSeries.update(data.candle); metaLine.applyOptions({ price: data.price * 1.01 });
                    if (data.next_close && data.next_close !== nextCloseTime) { nextCloseTime = data.next_close; startCountdown(); }
                    if (data.signal && data.signal !== lastSignal) {
                        const color = data.signal === "LONG" ? '#D4AF37' : '#FF073A'; const shape = data.signal === "LONG" ? 'arrowUp' : 'arrowDown'; const pos = data.signal === "LONG" ? 'belowBar' : 'aboveBar';
                        candleSeries.setMarkers([{ time: data.candle.time, position: pos, color: color, shape: shape, text: 'GOLD ' + data.signal }]); lastSignal = data.signal;
                    } else if (!data.signal) { lastSignal = null; candleSeries.setMarkers([]); }
                }
            };
            ws.onclose = () => setTimeout(connect, 3000);
        }

        function changeTf(tf) {
            document.querySelectorAll('.tf-btn').forEach(b => b.classList.remove('active')); document.getElementById('btn-' + tf).classList.add('active');
            document.getElementById('chart-tf-display').innerText = tf; document.getElementById('candle-countdown').innerText = "LOADING...";
            if(ws && ws.readyState === WebSocket.OPEN) { ws.send(JSON.stringify({ timeframe: tf })); candleSeries.setData([]); }
        }

        setInterval(() => { const now = new Date(); document.getElementById('clock-local').innerText = now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}); document.getElementById('clock-ny').innerText = new Date(now.toLocaleString("en-US", {timeZone: "America/New_York"})).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}); }, 1000);
        function executeTrade() { const text = document.getElementById('btn-text').innerText; if(text.includes("WAITING")) return; alert("ORDER SENT TO KRAKEN API: " + text); }
        connect();
    </script>
</body>
</html>
