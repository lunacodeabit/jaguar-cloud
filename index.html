<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JAGUAR COMMAND CENTER</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { background-color: #080808; color: #e5e5e5; font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .neon-green { color: #39FF14; text-shadow: 0 0 15px rgba(57, 255, 20, 0.5); }
        .neon-red { color: #FF073A; text-shadow: 0 0 15px rgba(255, 7, 58, 0.5); }
        .glass-panel { 
            background: linear-gradient(145deg, rgba(20,20,20,0.9) 0%, rgba(10,10,10,0.95) 100%); 
            border: 1px solid rgba(255, 255, 255, 0.08); 
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }
        .btn-execute {
            background: rgba(57, 255, 20, 0.05);
            border: 1px solid #39FF14;
            color: #39FF14;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-execute:active { transform: scale(0.95); background: #39FF14; color: black; }
        
        /* Ajustes para Móvil */
        @media (max-width: 1024px) {
            .desktop-grid { display: flex; flex-direction: column; gap: 1rem; height: auto; }
            .mobile-h-chart { height: 400px; }
            .mobile-h-panel { height: 160px; }
        }
    </style>
</head>
<body class="min-h-screen w-full flex flex-col p-4 lg:p-6 overflow-y-auto lg:overflow-hidden">

    <header class="flex justify-between items-end mb-4 px-2 shrink-0">
        <div class="flex items-center gap-3">
            <div class="w-2 h-2 rounded-full bg-red-500" id="status-dot"></div>
            <div>
                <h1 class="text-xl font-bold tracking-[0.2em] text-white">JAGUAR</h1>
                <div class="text-[10px] text-gray-500 tracking-widest">COMMAND CENTER</div>
            </div>
        </div>
        <div class="text-[#333] font-mono tracking-widest text-sm">3 · 6 · 9</div>
    </header>

    <div class="desktop-grid lg:grid lg:grid-cols-12 lg:grid-rows-6 gap-4 flex-1">
        
        <div class="lg:col-span-3 lg:row-span-2 glass-panel rounded-2xl p-5 flex flex-col justify-between mobile-h-panel">
            <div class="flex justify-between border-b border-gray-800 pb-2">
                <div><div class="text-[10px] text-gray-500">STO DGO</div><div class="font-mono text-xl" id="clock-local">--:--</div></div>
                <div class="text-right"><div class="text-[10px] text-gray-500">NEW YORK</div><div class="font-mono text-xl text-white" id="clock-ny">--:--</div></div>
            </div>
            <div class="flex-1 flex flex-col justify-center items-center mt-2">
                <div class="text-[10px] text-gray-500 tracking-widest mb-1">TENDENCIA</div>
                <div class="text-3xl font-black" id="trend-text">--</div>
            </div>
        </div>

        <div class="lg:col-span-6 lg:row-span-6 glass-panel rounded-2xl p-1 relative flex flex-col mobile-h-chart order-first lg:order-none">
            <div class="absolute top-4 left-4 z-10 bg-black/50 backdrop-blur-md px-4 py-2 rounded-lg border border-white/10">
                <div class="flex items-center gap-2">
                    <div class="w-6 h-6 bg-[#F7931A] rounded-full flex items-center justify-center text-black font-bold text-[10px]">₿</div>
                    <div>
                        <div class="font-bold text-white text-sm">Bitcoin / USD</div>
                        <div class="font-mono text-xl text-white" id="price-display">$00,000.00</div>
                    </div>
                </div>
            </div>
            <div id="tv-chart" class="w-full h-full rounded-xl overflow-hidden"></div>
        </div>

        <div class="lg:col-span-3 lg:row-span-3 glass-panel rounded-2xl p-6 flex flex-col items-center justify-center relative overflow-hidden mobile-h-panel">
            <div class="absolute top-0 w-full h-1 bg-gradient-to-r from-transparent via-gray-700 to-transparent"></div>
            <div class="text-[10px] text-gray-500 mb-2 tracking-widest">JAGUAR SCORE</div>
            <div class="text-7xl lg:text-8xl font-mono font-bold neon-green" id="score-display">0.0</div>
            <div class="text-gray-600 text-xs mt-2">CONFIDENCE LEVEL</div>
        </div>

        <div class="lg:col-span-3 lg:row-span-4 glass-panel rounded-2xl p-5 flex flex-col justify-end mobile-h-panel">
            <div class="flex justify-between mb-2 items-end">
                <span class="text-[10px] text-gray-500">GASOLINA (MFI)</span>
                <span class="text-xl font-mono neon-green" id="mfi-value">0%</span>
            </div>
            <div class="w-full bg-gray-900 rounded-sm h-6 overflow-hidden border border-gray-800 relative">
                <div class="bg-[#39FF14] h-full transition-all duration-1000 opacity-80" style="width: 0%" id="mfi-bar"></div>
                <div class="absolute inset-0 grid grid-cols-10 w-full h-full">
                    <div class="border-r border-black/20"></div><div class="border-r border-black/20"></div><div class="border-r border-black/20"></div><div class="border-r border-black/20"></div><div class="border-r border-black/20"></div>
                    <div class="border-r border-black/20"></div><div class="border-r border-black/20"></div><div class="border-r border-black/20"></div><div class="border-r border-black/20"></div>
                </div>
            </div>
            <div class="text-[10px] text-gray-600 mt-2 text-right">MFI > 80% (PELIGRO)</div>
        </div>

        <div class="lg:col-span-3 lg:row-span-3 glass-panel rounded-2xl p-1 mobile-h-panel">
            <button class="w-full h-full rounded-xl btn-execute flex flex-col items-center justify-center group" onclick="executeTrade()">
                <div class="text-xl font-bold tracking-wider lg:group-hover:scale-105 transition-transform">EJECUTAR LONG</div>
                <div class="text-[10px] mt-2 opacity-60 font-mono">RIESGO: $100.00</div>
            </button>
        </div>
    </div>

    <script>
        const chartContainer = document.getElementById('tv-chart');
        const chart = LightweightCharts.createChart(chartContainer, {
            layout: { background: { color: '#000000' }, textColor: '#DDD', },
            grid: { vertLines: { color: '#111' }, horzLines: { color: '#111' } },
            rightPriceScale: { borderColor: '#333' },
            timeScale: { borderColor: '#333', timeVisible: true, secondsVisible: false },
            crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
        });

        const candleSeries = chart.addCandlestickSeries({
            upColor: '#39FF14', downColor: '#FF073A', borderVisible: false, wickUpColor: '#39FF14', wickDownColor: '#FF073A',
        });

        new ResizeObserver(entries => {
            if (entries.length === 0 || entries[0].target !== chartContainer) { return; }
            const newRect = entries[0].contentRect;
            chart.applyOptions({ width: newRect.width, height: newRect.height });
        }).observe(chartContainer);

        function updateClocks() {
            const now = new Date();
            document.getElementById('clock-local').innerText = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            document.getElementById('clock-ny').innerText = new Date(now.toLocaleString("en-US", {timeZone: "America/New_York"})).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }
        setInterval(updateClocks, 1000);

        const statusDot = document.getElementById('status-dot');
        const priceDisplay = document.getElementById('price-display');
        const scoreDisplay = document.getElementById('score-display');
        const trendText = document.getElementById('trend-text');
        const mfiValue = document.getElementById('mfi-value');
        const mfiBar = document.getElementById('mfi-bar');

        function connect() {
            console.log("Conectando al Jaguar...");
            const protocol = window.location.protocol === "https:" ? "wss://" : "ws://";
            const wsUrl = protocol + window.location.host + "/ws";
            const ws = new WebSocket(wsUrl);

            ws.onopen = () => {
                statusDot.classList.replace('bg-red-500', 'bg-green-500');
            };

            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                priceDisplay.innerText = "$" + data.price.toLocaleString(undefined, {minimumFractionDigits: 2});
                scoreDisplay.innerText = data.score;
                
                if(data.score < 5) scoreDisplay.className = "text-7xl lg:text-8xl font-mono font-bold neon-red";
                else scoreDisplay.className = "text-7xl lg:text-8xl font-mono font-bold neon-green";

                trendText.innerText = data.trend;
                trendText.className = data.trend === "ALCISTA" ? "text-3xl font-black neon-green" : "text-3xl font-black neon-red";

                mfiValue.innerText = data.mfi + "%";
                mfiBar.style.width = data.mfi + "%";

                if (data.candle) {
                    candleSeries.update(data.candle);
                }
            };

            ws.onclose = () => {
                statusDot.classList.replace('bg-green-500', 'bg-red-500');
                setTimeout(connect, 3000);
            };
        }

        function executeTrade() { alert("ORDEN DE COMPRA ENVIADA (SIMULACIÓN)"); }
        
        connect();
    </script>
</body>
</html>
