<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JAGUAR COMMAND CENTER</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;900&display=swap" rel="stylesheet">
    <style>
        body { background-color: #050505; color: #e5e5e5; font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .neon-green { color: #39FF14; text-shadow: 0 0 15px rgba(57, 255, 20, 0.6); }
        .neon-red { color: #FF073A; text-shadow: 0 0 15px rgba(255, 7, 58, 0.6); }
        
        .glass-panel { 
            background: linear-gradient(145deg, rgba(20,20,20,0.8) 0%, rgba(10,10,10,0.95) 100%); 
            border: 1px solid rgba(255, 255, 255, 0.08); 
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
            min-height: 160px;
        }
        
        /* Buttons */
        .btn-execute { background: rgba(57, 255, 20, 0.05); border: 2px solid #39FF14; color: #39FF14; transition: all 0.2s; box-shadow: 0 0 15px rgba(57,255,20,0.1); }
        .btn-execute:active { transform: scale(0.95); }
        .btn-execute.short { background: rgba(255, 7, 58, 0.05); border-color: #FF073A; color: #FF073A; box-shadow: 0 0 15px rgba(255, 7, 58, 0.1); }
        .btn-execute.wait { background: rgba(100,100,100,0.1); border-color: #666; color: #888; box-shadow: none; cursor: not-allowed; }
        .btn-execute.active-trade { background: rgba(212, 175, 55, 0.1); border-color: #D4AF37; color: #D4AF37; box-shadow: 0 0 20px rgba(212, 175, 55, 0.2); }

        .tf-container { -ms-overflow-style: none; scrollbar-width: none; }
        .tf-container::-webkit-scrollbar { display: none; }
        .tf-btn { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #888; font-family: 'JetBrains Mono'; font-size: 0.7rem; transition: all 0.2s; white-space: nowrap; min-width: 35px; }
        .tf-btn:hover { border-color: #39FF14; color: #fff; }
        .tf-btn.active { background: #39FF14; color: #000; border-color: #39FF14; font-weight: bold; }
        #guide-modal { transition: opacity 0.3s ease; }
        .guide-card { border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.03); padding: 1.5rem; rounded: 1rem; display: flex; flex-direction: column; align-items: center; text-align: center; }
        .guide-icon { font-size: 2.5rem; margin-bottom: 1rem; }
        
        @keyframes slow-glow { 0%, 100% { box-shadow: 0 0 5px rgba(212, 175, 55, 0.2), inset 0 0 5px rgba(212, 175, 55, 0.1); border-color: rgba(212, 175, 55, 0.3); color: #888; } 50% { box-shadow: 0 0 20px rgba(212, 175, 55, 0.5), inset 0 0 10px rgba(212, 175, 55, 0.2); border-color: rgba(212, 175, 55, 1); color: #D4AF37; } }
        .help-glow { animation: slow-glow 4s ease-in-out infinite; }
        .jaguar-img-blend { mix-blend-mode: screen; }

        @media (max-width: 1024px) { .desktop-grid { display: flex; flex-direction: column; gap: 1rem; } .mobile-chart { height: 450px; order: -1; min-height: 450px; } .glass-panel { min-height: auto; } }
    </style>
</head>
<body class="min-h-screen w-full flex flex-col p-4 lg:p-6 overflow-y-auto lg:overflow-hidden relative">

    <header class="flex flex-col lg:flex-row justify-between items-center mb-6 shrink-0 gap-4 lg:gap-0">
        <div class="flex items-center gap-3 self-start lg:self-auto">
            <img src="https://i.postimg.cc/WbcLNVJ1/Gemini-Generated-Image-8lzcv38lzcv38lzc.png" alt="Jaguar Logo" class="w-14 h-14 object-contain jaguar-img-blend">
            <div><h1 class="text-2xl font-black tracking-[0.1em] text-white">JAGUAR <span class="text-[#D4AF37]">3Â·6Â·9</span></h1><div class="text-xs text-gray-500 tracking-widest">COMMAND CENTER</div></div>
            <button onclick="toggleModal(true)" class="ml-4 w-10 h-10 rounded-full border flex items-center justify-center transition-all help-glow">?</button>
        </div>
        <div class="flex gap-2 overflow-x-auto tf-container w-full lg:w-auto pb-1 lg:pb-0">
            <button class="tf-btn px-3 py-1 rounded active" onclick="changeTf('1m')" id="btn-1m">1m</button>
            <button class="tf-btn px-3 py-1 rounded" onclick="changeTf('5m')" id="btn-5m">5m</button>
            <button class="tf-btn px-3 py-1 rounded" onclick="changeTf('15m')" id="btn-15m">15m</button>
            <button class="tf-btn px-3 py-1 rounded" onclick="changeTf('30m')" id="btn-30m">30m</button>
            <button class="tf-btn px-3 py-1 rounded" onclick="changeTf('1h')" id="btn-1h">1H</button>
            <button class="tf-btn px-3 py-1 rounded" onclick="changeTf('4h')" id="btn-4h">4H</button>
            <button class="tf-btn px-3 py-1 rounded" onclick="changeTf('1d')" id="btn-1d">D</button>
            <button class="tf-btn px-3 py-1 rounded" onclick="changeTf('1w')" id="btn-1w">W</button>
        </div>
    </header>

    <div class="desktop-grid lg:grid lg:grid-cols-12 lg:grid-rows-6 gap-6 flex-1 lg:min-h-[600px]">
        <div class="lg:col-span-3 lg:row-span-6 flex flex-col gap-6">
            <div class="grid grid-cols-2 gap-4 flex-1">
                <div class="glass-panel rounded-2xl p-4 flex flex-col justify-center items-center"><div class="text-[10px] text-gray-500 mb-1">LOCAL</div><div class="font-mono text-xl" id="clock-local">--:--</div></div>
                <div class="glass-panel rounded-2xl p-4 flex flex-col justify-center items-center"><div class="text-[10px] text-gray-500 mb-1">NY</div><div class="font-mono text-xl text-[#39FF14]" id="clock-ny">--:--</div></div>
            </div>
            <div class="glass-panel rounded-2xl p-6 flex flex-col justify-center items-center flex-[2]">
                <div class="text-[10px] text-gray-500 tracking-widest mb-4">MAJOR TREND</div><div class="text-4xl font-black mb-2" id="trend-text">WAITING</div><div class="text-6xl animate-pulse" id="trend-icon">--</div>
            </div>
            <div class="glass-panel rounded-2xl p-5 flex flex-col justify-center flex-1">
                <div class="flex justify-between mb-2 items-end"><span class="text-[10px] text-gray-500 uppercase">MFI Fuel</span><span class="text-xl font-mono" id="mfi-text-color"><span id="mfi-value">0</span>%</span></div>
                <div class="w-full bg-gray-900 rounded-sm h-4 overflow-hidden border border-gray-800 relative"><div class="bg-[#D4AF37] h-full transition-all duration-1000" style="width: 0%" id="mfi-bar"></div></div><div class="text-[9px] text-gray-600 mt-2 text-right">OVERBOUGHT > 80%</div>
            </div>
        </div>
        <div class="lg:col-span-6 lg:row-span-6 glass-panel rounded-2xl p-1 relative flex flex-col mobile-chart">
            <div class="absolute top-4 left-4 z-10 flex gap-3 flex-wrap">
                <div class="bg-black/60 backdrop-blur px-3 py-2 rounded border border-white/10 flex items-center gap-3">
                    <div class="w-8 h-8 bg-[#F7931A] rounded-full flex items-center justify-center text-black font-bold text-xs">â‚¿</div><div><div class="font-bold text-white text-xs">Bitcoin</div><div class="font-mono text-lg text-white" id="price-display">$00,000.00</div></div>
                </div>
                <div class="bg-black/60 backdrop-blur px-3 py-2 rounded border border-white/10 flex items-center gap-2 font-mono text-xs">
                     <span class="text-gray-400">TF:</span><span class="text-[#39FF14]" id="chart-tf-display">1m</span><span class="text-gray-600">|</span><span class="text-gray-400">CLOSE IN:</span><span class="text-white font-bold" id="candle-countdown">--:--</span>
                     <span class="text-gray-600">|</span><button onclick="fitChart()" class="text-[#D4AF37] hover:text-white transition-colors font-bold tracking-wider" title="Auto Scale Chart">AUTO</button>
                </div>
            </div>
            <div id="tv-chart" class="w-full h-full rounded-xl overflow-hidden"></div>
        </div>
        <div class="lg:col-span-3 lg:row-span-6 flex flex-col gap-6">
            <div class="glass-panel rounded-2xl p-6 flex flex-col items-center justify-center flex-[2] relative overflow-hidden">
                <div class="text-[10px] text-gray-500 mb-4 tracking-widest">JAGUAR SCORE</div><div class="text-8xl font-mono font-bold neon-green" id="score-display">0.0</div><div class="text-gray-600 text-xs mt-2 text-center">CONFIDENCE<br>LEVEL / 10</div>
            </div>
            <button id="main-btn" class="glass-panel rounded-2xl p-8 btn-execute wait flex flex-col items-center justify-center flex-1 group" onclick="executeTrade()">
                <div class="text-2xl font-bold tracking-wider group-hover:scale-105 transition-transform" id="btn-text">WAITING...</div><div class="text-xs mt-2 opacity-70 font-mono" id="btn-subtext">(ANALYZING MARKET)</div>
            </button>
        </div>
    </div>

    <div id="guide-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/95 opacity-0 pointer-events-none backdrop-blur-md p-4 transition-all duration-500">
        <div class="glass-panel max-w-4xl w-full max-h-[90vh] overflow-y-auto rounded-3xl p-8 relative border-[#D4AF37]/30">
            <button onclick="toggleModal(false)" class="absolute top-6 right-6 text-gray-500 hover:text-white text-xl">âœ•</button>
            <div class="text-center mb-10"><h2 class="text-4xl font-black text-[#D4AF37] tracking-widest mb-2">THE JAGUAR PROTOCOL</h2><p class="text-gray-400 font-mono">SYSTEM ARCHITECTURE v5.0 // INSTITUTIONAL</p></div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
                <div class="guide-card group hover:border-[#00FFFF]/50 transition-all"><div class="guide-icon text-[#00FFFF] group-hover:scale-110 transition-transform">ðŸ’§</div><h3 class="text-xl font-bold text-white mb-2">LIQUIDITY POOLS</h3><p class="text-sm text-gray-400">Cyan Lines. These represent Stop Loss clusters. Price often hunts these levels (Swing Highs/Lows) before reversing.</p></div>
                <div class="guide-card group hover:border-[#FFA500]/50 transition-all"><div class="guide-icon text-[#FFA500] group-hover:scale-110 transition-transform">ðŸ§²</div><h3 class="text-xl font-bold text-white mb-2">ACCUMULATION (POC)</h3><p class="text-sm text-gray-400">Orange Line. The "Fair Value" price where most volume was traded. Acts as a magnet for price.</p></div>
            </div>
            <div class="bg-[#39FF14]/10 border border-[#39FF14]/30 p-6 rounded-xl text-center"><h4 class="text-[#39FF14] font-bold mb-2 tracking-widest">EXECUTION PROTOCOL</h4><p class="text-white text-lg font-bold">WAIT FOR SIGNAL â†’ CHECK LIQUIDITY â†’ PRESS EXECUTE</p></div>
        </div>
    </div>

    <script>
        function toggleModal(show) { const m = document.getElementById('guide-modal'); show ? m.classList.remove('pointer-events-none', 'opacity-0') : m.classList.add('pointer-events-none', 'opacity-0'); }
        const chartContainer = document.getElementById('tv-chart');
        const chart = LightweightCharts.createChart(chartContainer, { layout: { background: { color: '#000000' }, textColor: '#666', }, grid: { vertLines: { color: '#111' }, horzLines: { color: '#111' } }, rightPriceScale: { borderColor: '#333', scaleMargins: { top: 0.1, bottom: 0.1 } }, timeScale: { borderColor: '#333', timeVisible: true, secondsVisible: false }, });
        const candleSeries = chart.addCandlestickSeries({ upColor: '#39FF14', downColor: '#FF073A', borderVisible: false, wickUpColor: '#39FF14', wickDownColor: '#FF073A' });
        const metaLine = candleSeries.createPriceLine({ price: 0, color: '#39FF14', lineWidth: 1, lineStyle: LightweightCharts.LineStyle.Dotted, axisLabelVisible: true, title: 'META 1 (TARGET)' });
        
        function fitChart() { chart.timeScale().fitContent(); }

        let entryLine = null, slLine = null, tpLine = null, activeTrade = false, candleHistory = [];
        let liqHighLine = null, liqLowLine = null, pocLine = null; // INSTITUTIONAL LINES

        new ResizeObserver(entries => { if (entries.length === 0 || entries[0].target !== chartContainer) return; chart.applyOptions({ width: entries[0].contentRect.width, height: entries[0].contentRect.height }); chart.timeScale().fitContent(); }).observe(chartContainer);

        let ws, nextCloseTime = 0, countdownInterval, lastSignal = null, currentPrice = 0, firstLoad = true;

        function startCountdown() {
            clearInterval(countdownInterval);
            countdownInterval = setInterval(() => {
                if (!nextCloseTime) return;
                const now = Math.floor(Date.now() / 1000); const diff = nextCloseTime - now;
                if (diff <= 0) { document.getElementById('candle-countdown').innerText = "CLOSING..."; return; }
                const h = Math.floor(diff / 3600); const m = Math.floor((diff % 3600) / 60); const s = diff % 60;
                let display = `${m}:${s < 10 ? '0' + s : s}`; if(h > 0) display = `${h}:${display}`;
                document.getElementById('candle-countdown').innerText = display;
            }, 1000);
        }

        function connect() {
            const protocol = window.location.protocol === "https:" ? "wss://" : "ws://";
            ws = new WebSocket(protocol + window.location.host + "/ws");
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                currentPrice = data.price;
                document.getElementById('price-display').innerText = "$" + data.price.toLocaleString(undefined, {minimumFractionDigits: 2});
                
                const scoreEl = document.getElementById('score-display'); scoreEl.innerText = data.score;
                scoreEl.className = data.score < 5 ? "text-8xl font-mono font-bold neon-red" : "text-8xl font-mono font-bold neon-green";

                const trendText = document.getElementById('trend-text'); const trendIcon = document.getElementById('trend-icon');
                trendText.innerText = data.trend;
                if(data.trend === "BULLISH") { trendText.className = "text-4xl font-black mb-2 neon-green"; trendIcon.innerText = "â†‘"; trendIcon.className = "text-6xl neon-green animate-bounce"; } 
                else if(data.trend === "BEARISH") { trendText.className = "text-4xl font-black mb-2 neon-red"; trendIcon.innerText = "â†“"; trendIcon.className = "text-6xl neon-red animate-bounce"; }
                else { trendText.className = "text-4xl font-black mb-2 text-gray-500"; trendIcon.innerText = "--"; trendIcon.className = "text-6xl text-gray-500"; }

                document.getElementById('mfi-value').innerText = data.mfi; document.getElementById('mfi-bar').style.width = data.mfi + "%";
                document.getElementById('mfi-text-color').className = data.mfi > 80 ? "text-xl font-mono text-red-500" : (data.mfi < 20 ? "text-xl font-mono neon-green" : "text-xl font-mono text-[#D4AF37]");

                const btn = document.getElementById('main-btn'); const btnText = document.getElementById('btn-text'); const btnSub = document.getElementById('btn-subtext');
                if(!activeTrade) {
                    if (data.score >= 7.5) { btn.className = "glass-panel rounded-2xl p-8 btn-execute flex flex-col items-center justify-center flex-1 group"; btnText.innerText = "EXECUTE LONG"; btnSub.innerText = "($100 RISK)"; }
                    else if (data.score <= 2.5) { btn.className = "glass-panel rounded-2xl p-8 btn-execute short flex flex-col items-center justify-center flex-1 group"; btnText.innerText = "EXECUTE SHORT"; btnSub.innerText = "($100 RISK)"; }
                    else { btn.className = "glass-panel rounded-2xl p-8 btn-execute wait flex flex-col items-center justify-center flex-1 group"; btnText.innerText = "WAITING FOR SIGNAL"; btnSub.innerText = "(SCORE MUST BE >7.5 or <2.5)"; }
                }

                // DRAW INSTITUTIONAL LINES
                if (data.institutional) {
                    if (liqHighLine) candleSeries.removePriceLine(liqHighLine);
                    liqHighLine = candleSeries.createPriceLine({ price: data.institutional.liq_high, color: '#00FFFF', lineWidth: 1, lineStyle: LightweightCharts.LineStyle.Dashed, axisLabelVisible: true, title: 'LIQUIDITY (HIGH)' });

                    if (liqLowLine) candleSeries.removePriceLine(liqLowLine);
                    liqLowLine = candleSeries.createPriceLine({ price: data.institutional.liq_low, color: '#00FFFF', lineWidth: 1, lineStyle: LightweightCharts.LineStyle.Dashed, axisLabelVisible: true, title: 'LIQUIDITY (LOW)' });

                    if (pocLine) candleSeries.removePriceLine(pocLine);
                    pocLine = candleSeries.createPriceLine({ price: data.institutional.poc, color: '#FFA500', lineWidth: 2, lineStyle: LightweightCharts.LineStyle.Solid, axisLabelVisible: true, title: 'POC (ACCUMULATION)' });
                }

                if (data.candle) {
                    candleSeries.update(data.candle);
                    metaLine.applyOptions({ price: data.price * 1.01 });
                    if (data.next_close && data.next_close !== nextCloseTime) { nextCloseTime = data.next_close; startCountdown(); }
                    candleHistory.push(data.candle); if(candleHistory.length > 20) candleHistory.shift();
                    if (data.signal === "LONG" && lastSignal !== "LONG") { candleSeries.setMarkers([{ time: data.candle.time, position: 'belowBar', color: '#D4AF37', shape: 'arrowUp', text: 'GOLD LONG' }]); lastSignal = "LONG"; } 
                    else if (!data.signal) { lastSignal = null; candleSeries.setMarkers([]); }
                    if(firstLoad) { fitChart(); firstLoad = false; }
                }
            };
            ws.onclose = () => setTimeout(connect, 3000);
        }

        function changeTf(tf) {
            document.querySelectorAll('.tf-btn').forEach(b => b.classList.remove('active')); document.getElementById('btn-' + tf).classList.add('active');
            document.getElementById('chart-tf-display').innerText = tf; document.getElementById('candle-countdown').innerText = "SYNCING..."; nextCloseTime = 0;
            candleHistory = []; activeTrade = false; clearTradeLines(); firstLoad = true;
            if(ws && ws.readyState === WebSocket.OPEN) { ws.send(JSON.stringify({ timeframe: tf })); candleSeries.setData([]); }
        }

        function clearTradeLines() {
             if(entryLine) { candleSeries.removePriceLine(entryLine); entryLine = null; }
             if(slLine) { candleSeries.removePriceLine(slLine); slLine = null; }
             if(tpLine) { candleSeries.removePriceLine(tpLine); tpLine = null; }
             document.getElementById('main-btn').classList.remove('active-trade');
        }

        function executeTrade() {
            const text = document.getElementById('btn-text').innerText;
            if(text.includes("WAITING") || activeTrade) return;
            if(text.includes("LONG")) {
                activeTrade = true; const entryPrice = currentPrice;
                let lowestLow = entryPrice * 0.99;
                if(candleHistory.length > 5) { lowestLow = Math.min(...candleHistory.slice(-10).map(c => c.low)); if(lowestLow >= entryPrice) lowestLow = entryPrice * 0.995; }
                const risk = entryPrice - lowestLow; const takeProfit = entryPrice + (risk * 2);
                clearTradeLines();
                entryLine = candleSeries.createPriceLine({ price: entryPrice, color: '#3B82F6', lineWidth: 2, lineStyle: LightweightCharts.LineStyle.Solid, axisLabelVisible: true, title: 'ENTRY: $' + entryPrice.toFixed(2) });
                slLine = candleSeries.createPriceLine({ price: lowestLow, color: '#FF073A', lineWidth: 2, lineStyle: LightweightCharts.LineStyle.Solid, axisLabelVisible: true, title: 'STOP: $' + lowestLow.toFixed(2) });
                tpLine = candleSeries.createPriceLine({ price: takeProfit, color: '#39FF14', lineWidth: 2, lineStyle: LightweightCharts.LineStyle.Solid, axisLabelVisible: true, title: 'TARGET: $' + takeProfit.toFixed(2) });
                const btn = document.getElementById('main-btn'); btn.className = "glass-panel rounded-2xl p-8 btn-execute active-trade flex flex-col items-center justify-center flex-1 group";
                document.getElementById('btn-text').innerText = "TRADE ACTIVE"; document.getElementById('btn-subtext').innerText = "MONITORING SL/TP...";
            }
        }

        setInterval(() => { const now = new Date(); document.getElementById('clock-local').innerText = now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}); document.getElementById('clock-ny').innerText = new Date(now.toLocaleString("en-US", {timeZone: "America/New_York"})).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}); }, 1000);
        connect();
    </script>
</body>
</html>
