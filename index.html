<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JAGUAR COMMAND CENTER</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;900&display=swap" rel="stylesheet">
    <style>
        body { background-color: #050505; color: #e5e5e5; font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .neon-green { color: #39FF14; text-shadow: 0 0 15px rgba(57, 255, 20, 0.6); }
        .neon-red { color: #FF073A; text-shadow: 0 0 15px rgba(255, 7, 58, 0.6); }
        .glass-panel { 
            background: linear-gradient(145deg, rgba(20,20,20,0.8) 0%, rgba(10,10,10,0.95) 100%); 
            border: 1px solid rgba(255, 255, 255, 0.08); 
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }
        .btn-execute {
            background: rgba(57, 255, 20, 0.05); border: 2px solid #39FF14; color: #39FF14;
            transition: all 0.2s; box-shadow: 0 0 15px rgba(57,255,20,0.1);
        }
        .btn-execute:active { transform: scale(0.95); background: #39FF14; color: black; }
        
        /* Timeframe Buttons - Scrollable Container */
        .tf-container {
            -ms-overflow-style: none; scrollbar-width: none;
        }
        .tf-container::-webkit-scrollbar { display: none; }
        
        .tf-btn {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #888;
            font-family: 'JetBrains Mono'; font-size: 0.7rem; transition: all 0.2s;
            white-space: nowrap; min-width: 35px;
        }
        .tf-btn:hover { border-color: #39FF14; color: #fff; }
        .tf-btn.active { background: #39FF14; color: #000; border-color: #39FF14; font-weight: bold; }

        @media (max-width: 1024px) {
            .desktop-grid { display: flex; flex-direction: column; gap: 1rem; }
            .mobile-chart { height: 420px; order: -1; } 
        }
    </style>
</head>
<body class="min-h-screen w-full flex flex-col p-4 lg:p-6 overflow-y-auto lg:overflow-hidden">

    <header class="flex flex-col lg:flex-row justify-between items-center mb-6 shrink-0 gap-4 lg:gap-0">
        <div class="flex items-center gap-3 self-start lg:self-auto">
            <svg class="w-10 h-10 text-[#e5b80b]" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.5 13.5c0-1.8.8-3.3 2.1-4.2.6-.4 1.1-.1 1 .5-.2.8-.2 1.7 0 2.5.2.8 1 1.2 1.8 1.1.9-.2 1.5-.9 1.4-1.8-.1-.7-.5-1.3-1.1-1.6-.5-.3-1.1-.3-1.6 0-.4.2-.8.1-1-.2-.6-1.1-.2-2.4 1-2.9 1.2-.5 2.6-.3 3.7.6.9.7 1.4 1.8 1.5 2.9.1 1.6-1.1 3-2.7 3.2-1.6.2-3.1-1-3.3-2.6-.2-1.3.6-2.5 1.8-3 1.1-.5 2.4-.1 3 .9.1.2.3.2.5.1.2-.1.3-.3.2-.5-.8-1.4-2.6-1.9-4.1-1.2-1.5.7-2.3 2.4-1.9 4 .4 1.5 1.8 2.6 3.4 2.5 1.6-.1 2.9-1.4 3-3 .1-1.3-.6-2.5-1.7-3.1l.1-.1c1.5-.6 3.2-.4 4.5.6 1.8 1.3 2.6 3.6 2 5.7-.5 2.1-2.4 3.6-4.6 3.6h-.5c-.4 0-.7.3-.7.7 0 .4.3.7.7.7h.5c2.6 0 4.9-1.8 5.5-4.3.7-2.6-.3-5.3-2.4-6.8-1.8-1.3-4.1-1.5-6.1-.5-2.5 1.2-3.9 4-3.4 6.7.4 2.3 2.3 4.1 4.7 4.2h.5c.4 0 .7-.3.7-.7 0-.4-.3-.7-.7-.7h-.5c-2-.1-3.7-1.7-3.7-3.8z" fill="#D4AF37"/>
            </svg>
            <div>
                <h1 class="text-xl font-black tracking-[0.1em] text-white">JAGUAR <span class="text-[#D4AF37]">3·6·9</span></h1>
                <div class="text-[10px] text-gray-500 tracking-widest">COMMAND CENTER</div>
            </div>
        </div>
        
        <div class="flex gap-2 overflow-x-auto tf-container w-full lg:w-auto pb-1 lg:pb-0">
            <button class="tf-btn px-3 py-1 rounded active" onclick="changeTf('1m')" id="btn-1m">1m</button>
            <button class="tf-btn px-3 py-1 rounded" onclick="changeTf('5m')" id="btn-5m">5m</button>
            <button class="tf-btn px-3 py-1 rounded" onclick="changeTf('15m')" id="btn-15m">15m</button>
            <button class="tf-btn px-3 py-1 rounded" onclick="changeTf('30m')" id="btn-30m">30m</button>
            <button class="tf-btn px-3 py-1 rounded" onclick="changeTf('1h')" id="btn-1h">1H</button>
            <button class="tf-btn px-3 py-1 rounded" onclick="changeTf('4h')" id="btn-4h">4H</button>
            <button class="tf-btn px-3 py-1 rounded" onclick="changeTf('1d')" id="btn-1d">D</button>
            <button class="tf-btn px-3 py-1 rounded" onclick="changeTf('1w')" id="btn-1w">W</button>
        </div>
    </header>

    <div class="desktop-grid lg:grid lg:grid-cols-12 lg:grid-rows-6 gap-6 flex-1">
        
        <div class="lg:col-span-3 lg:row-span-6 flex flex-col gap-4">
            
            <div class="grid grid-cols-2 gap-4 h-32">
                <div class="glass-panel rounded-2xl p-4 flex flex-col justify-center items-center">
                    <div class="text-[10px] text-gray-500 mb-1">LOCAL</div>
                    <div class="font-mono text-xl" id="clock-local">--:--</div>
                </div>
                <div class="glass-panel rounded-2xl p-4 flex flex-col justify-center items-center">
                    <div class="text-[10px] text-gray-500 mb-1">NY</div>
                    <div class="font-mono text-xl text-[#39FF14]" id="clock-ny">--:--</div>
                </div>
            </div>

            <div class="glass-panel rounded-2xl p-6 flex flex-col justify-center items-center flex-1">
                <div class="text-[10px] text-gray-500 tracking-widest mb-4">MAJOR TREND</div>
                <div class="text-4xl font-black mb-2" id="trend-text">WAITING</div>
                <div class="text-6xl animate-pulse" id="trend-icon">--</div>
            </div>

            <div class="glass-panel rounded-2xl p-5 h-32 flex flex-col justify-center">
                <div class="flex justify-between mb-2 items-end">
                    <span class="text-[10px] text-gray-500 uppercase">MFI Fuel</span>
                    <span class="text-xl font-mono" id="mfi-text-color"><span id="mfi-value">0</span>%</span>
                </div>
                <div class="w-full bg-gray-900 rounded-sm h-4 overflow-hidden border border-gray-800 relative">
                    <div class="bg-[#D4AF37] h-full transition-all duration-1000" style="width: 0%" id="mfi-bar"></div>
                </div>
                <div class="text-[9px] text-gray-600 mt-2 text-right">OVERBOUGHT > 80%</div>
            </div>
        </div>

        <div class="lg:col-span-6 lg:row-span-6 glass-panel rounded-2xl p-1 relative flex flex-col mobile-chart">
            <div class="absolute top-4 left-4 z-10 flex gap-4">
                <div class="bg-black/60 backdrop-blur px-3 py-2 rounded border border-white/10 flex items-center gap-3">
                    <div class="w-8 h-8 bg-[#F7931A] rounded-full flex items-center justify-center text-black font-bold text-xs">₿</div>
                    <div>
                        <div class="font-bold text-white text-xs">Bitcoin</div>
                        <div class="font-mono text-lg text-white" id="price-display">$00,000.00</div>
                    </div>
                </div>
                <div class="bg-black/60 backdrop-blur px-2 py-2 rounded border border-white/10 flex items-center">
                     <span class="font-mono text-xs text-[#39FF14]" id="chart-tf-display">1m</span>
                </div>
            </div>
            <div id="tv-chart" class="w-full h-full rounded-xl overflow-hidden"></div>
        </div>

        <div class="lg:col-span-3 lg:row-span-6 flex flex-col gap-4">
            
            <div class="glass-panel rounded-2xl p-6 flex flex-col items-center justify-center flex-1 relative overflow-hidden">
                <div class="text-[10px] text-gray-500 mb-4 tracking-widest">JAGUAR SCORE</div>
                <div class="text-8xl font-mono font-bold neon-green" id="score-display">0.0</div>
                <div class="text-gray-600 text-xs mt-2 text-center">CONFIDENCE<br>LEVEL / 10</div>
            </div>

            <button class="glass-panel rounded-2xl p-8 btn-execute flex flex-col items-center justify-center h-48 group" onclick="executeTrade()">
                <div class="text-2xl font-bold tracking-wider group-hover:scale-105 transition-transform">EXECUTE LONG</div>
                <div class="text-xs mt-2 opacity-70 font-mono text-[#39FF14] group-hover:opacity-100">($100 RISK)</div>
            </button>
        </div>
    </div>

    <script>
        // --- 1. CHART SETUP ---
        const chartContainer = document.getElementById('tv-chart');
        const chart = LightweightCharts.createChart(chartContainer, {
            layout: { background: { color: '#000000' }, textColor: '#666', },
            grid: { vertLines: { color: '#111' }, horzLines: { color: '#111' } },
            rightPriceScale: { borderColor: '#333' },
            timeScale: { borderColor: '#333', timeVisible: true, secondsVisible: false },
        });
        
        const candleSeries = chart.addCandlestickSeries({
            upColor: '#39FF14', downColor: '#FF073A', borderVisible: false, wickUpColor: '#39FF14', wickDownColor: '#FF073A',
        });

        // Price Target Line (Meta 1)
        const metaLine = candleSeries.createPriceLine({
            price: 0, color: '#39FF14', lineWidth: 1, lineStyle: LightweightCharts.LineStyle.Dotted, axisLabelVisible: true, title: 'META 1',
        });

        new ResizeObserver(entries => {
            if (entries.length === 0 || entries[0].target !== chartContainer) return;
            const newRect = entries[0].contentRect;
            chart.applyOptions({ width: newRect.width, height: newRect.height });
        }).observe(chartContainer);

        // --- 2. WEBSOCKET LOGIC ---
        let ws;
        let lastSignal = null;

        function connect() {
            const protocol = window.location.protocol === "https:" ? "wss://" : "ws://";
            ws = new WebSocket(protocol + window.location.host + "/ws");

            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                
                document.getElementById('price-display').innerText = "$" + data.price.toLocaleString(undefined, {minimumFractionDigits: 2});
                
                // Score Logic
                const scoreEl = document.getElementById('score-display');
                scoreEl.innerText = data.score;
                scoreEl.className = data.score < 5 ? "text-8xl font-mono font-bold neon-red" : "text-8xl font-mono font-bold neon-green";

                // Trend Logic
                const trendText = document.getElementById('trend-text');
                const trendIcon = document.getElementById('trend-icon');
                trendText.innerText = data.trend;
                if(data.trend === "BULLISH") {
                    trendText.className = "text-4xl font-black mb-2 neon-green";
                    trendIcon.innerText = "↑"; trendIcon.className = "text-6xl neon-green animate-bounce";
                } else {
                    trendText.className = "text-4xl font-black mb-2 neon-red";
                    trendIcon.innerText = "↓"; trendIcon.className = "text-6xl neon-red animate-bounce";
                }

                // Fuel Logic
                document.getElementById('mfi-value').innerText = data.mfi;
                document.getElementById('mfi-bar').style.width = data.mfi + "%";
                document.getElementById('mfi-text-color').className = data.mfi > 80 ? "text-xl font-mono text-red-500" : "text-xl font-mono text-[#D4AF37]";

                // Chart Update
                if (data.candle) {
                    candleSeries.update(data.candle);
                    metaLine.applyOptions({ price: data.price * 1.01 }); // Simulating target 1% above

                    // GOLD LONG MARKER
                    if (data.signal === "LONG" && lastSignal !== "LONG") {
                        candleSeries.setMarkers([{ 
                            time: data.candle.time, position: 'belowBar', color: '#D4AF37', shape: 'arrowUp', text: 'GOLD LONG' 
                        }]);
                        lastSignal = "LONG";
                    } else if (data.signal !== "LONG") {
                        lastSignal = null;
                        candleSeries.setMarkers([]);
                    }
                }
            };

            ws.onclose = () => setTimeout(connect, 3000);
        }

        // --- 3. TIMEFRAME SELECTOR ---
        function changeTf(tf) {
            document.querySelectorAll('.tf-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-' + tf).classList.add('active');
            document.getElementById('chart-tf-display').innerText = tf;
            
            if(ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({ timeframe: tf }));
                candleSeries.setData([]); 
            }
        }

        // --- 4. CLOCKS ---
        setInterval(() => {
            const now = new Date();
            document.getElementById('clock-local').innerText = now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
            document.getElementById('clock-ny').innerText = new Date(now.toLocaleString("en-US", {timeZone: "America/New_York"})).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
        }, 1000);

        function executeTrade() { alert("ORDER SENT TO KRAKEN API (SIMULATION MODE)"); }
        connect();
    </script>
</body>
</html>
